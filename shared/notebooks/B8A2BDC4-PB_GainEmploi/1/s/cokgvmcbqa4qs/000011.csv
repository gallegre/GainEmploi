"0","#| label: fig-nivvie"
"0","#| fig-cap: Niveau de vie et risque de pauvreté monétaire selon le salaire et la configuration familiale"
"0","#| fig-width: 12"
"0","#| fig-height: 8"
"0","#| fig-align: center"
"0","seuilpm=1312"
"0",""
"0","castyp <- read_excel(""cas types smic.xlsx"",sheet = ""synthese"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    cas = case_when(isocou==""isolé"" ~ ""Isolé"","
"0","                    isocou==""couple"" & actconj==""Inactif"" ~ ""En couple\nconjoint sans revenu"","
"0","                    isocou==""couple"" & actconj==""1 smic"" ~ ""En couple\nconjoint au Smic"","
"0","                    isocou==""couple"" & actconj==""Chômeur"" ~ ""En couple\nconjoint au chômage"", "
"0","                    TRUE ~ ""autre"""
"0","  ),"
"0","   nbenf2 = case_when(nbenf==0 ~ ""Sans enfant"","
"0","                    nbenf==1 ~ ""1 enfant"","
"0","                    nbenf==2 ~ ""2 enfants"","
"0","                    TRUE ~ ""autre"""
"0","  ),"
"0","  emp=case_when("
"0","    Salaire==0 ~ ""Sans emploi"","
"0","    Salaire==699.35 ~ ""Emploi à mi-temps au Smic"","
"0","    Salaire==1398.70 ~ ""Emploi à temps plein au Smic"","
"0","    TRUE~""autre"""
"0","  ),"
"0","  NVIESSPA=(RDISP-PA)/(RDISP/NVIE)"
"0","  ) %>% "
"0","  filter(cas != ""autre"" & nbenf2!=""autre"" & emp !=""autre"") %>% "
"0","  select(cas, nbenf2, NVIE,NVIESSPA,emp)"
"0",""
"0","base$emp <- factor(base$emp, levels = c(""Sans emploi"", ""Emploi à mi-temps au Smic"", ""Emploi à temps plein au Smic""))"
"0",""
"0","base$cas <- factor(base$cas, levels = c(""Isolé"", ""En couple\nconjoint sans revenu"", ""En couple\nconjoint au Smic"",""En couple\nconjoint au chômage""))"
"0",""
"0","base$nbenf2 <- factor(base$nbenf2, levels = c(""Sans enfant"", ""1 enfant"", ""2 enfants"")) "
"0",""
"0","seuils <- data.frame("
"0","  seuil = c(seuilpm, seuilpm*4/6),"
"0","  type = c(""Seuil de pauvreté monétaire (60 %)"", ""Seuil de grande pauvreté monétaire (40 %)"")"
"0",")"
"0",""
"0","base_long <- base %>%"
"0","  select(nbenf2, emp, cas, NVIE, NVIESSPA) %>%"
"0","  pivot_longer(cols = c(NVIE, NVIESSPA),"
"0","               names_to = ""prime_activite"","
"0","               values_to = ""montant"") %>%"
"0","  mutate(prime_activite = ifelse(prime_activite == ""NVIE"", ""Avec \nprime d'activité"", ""Sans \nprime d'acivité""))"
"0",""
"0","graph_pm<-ggplot() +"
"0","    geom_point_interactive("
"0","    data = base_long, aes(x =nbenf2, y = round(montant,0), "
"0","      colour = emp, "
"0","      tooltip=paste(""Niveau de vie :"",round(montant,0), ""€"")), "
"0","    size = 3"
"0","  )+"
"0","  facet_wrap(~cas, nrow = 1) +"
"0","  geom_hline(data = seuils, aes(yintercept = seuil, linetype = type),"
"0","             color = ""grey40"", linewidth = 0.5) +"
"0","  scale_y_continuous(limits = c(0, 2500)) +"
"0","  scale_linetype_manual("
"0","    name = """", "
"0","    values = c(""Seuil de pauvreté monétaire (60 %)"" = ""solid"", "
"0","               ""Seuil de grande pauvreté monétaire (40 %)"" = ""dashed"")"
"0","  ) +"
"0","  labs(title = ""Avec ou sans prime d'activité"","
"0","       color = ""Statut emploi"","
"0","       linetype = ""Seuils"") +"
"0","  theme_minimal() +"
"0","  theme("
"0","    axis.title.x = element_blank(),"
"0","    axis.title.y = element_blank(),"
"0","    legend.title = element_blank(),"
"0","    plot.title = element_text(size = rel(1.5),color=""#5E4FA2"",face=""bold""),"
"0","    legend.position = ""bottom"","
"0","    legend.box = ""vertical"","
"0","    legend.spacing.y = unit(0.001, ""cm""),"
"0","    plot.margin = margin(t = 5, r = 5, b = 5, l = 5),"
"0","    axis.line = element_line(color = ""black"", linewidth = 0.2),"
"0","    axis.text.x = element_text(size = rel(1.3), angle = 40, hjust = 1),"
"0","    axis.text.y = element_text(size = rel(1.3)),"
"0","    panel.border = element_rect(color = ""black"", fill = NA, linewidth = 0.5),"
"0","    legend.text = element_text(size =rel(1.3)),"
"0","    strip.text = element_text(size = rel(1.3),face=""bold"")"
"0","  ) +"
"0","  facet_grid(prime_activite ~ cas)"
"0",""
"0","igraph_pm<-girafe(ggobj = graph_pm)"
"0",""
"0","if (is_html_output()) {"
"0","  igraph_pm"
"0","} else {"
"0","  print(graph_pm)"
"0","}"
