"0","#| label: fig-gainsmarginaux"
"0","#| fig-cap: Gain marginaux effectifs pour une augmentation de 100 euros du revenu d'activité, selon la configuration familiale et le niveau de revenu initial - choix entre 2 graphiques"
"0",""
"0","castyp <- read_excel(""cas types gains marginaux.xlsx"",sheet = ""synthese"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    cas = case_when(isocou==""isolé"" & nbenf==0 ~ ""Isolé sans enfant"","
"0","                    isocou==""couple"" & actconj==""Inactif"" & nbenf==2 ~ ""Couple monoactif deux enfants"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==0 ~ ""Couple biactif sans enfant"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==2 ~ ""Couple biactif deux enfants"", "
"0","                    TRUE ~ ""autre"""
"0","  )) %>% "
"0","  filter(cas != ""autre"")  %>% "
"0","  mutate("
"0","    gainmarginal = RDISP,"
"0","    gainmarginal_sspa = round(RDISP-PA,2)"
"0","    "
"0","  ) %>% "
"0","  select(cas, activite, gainmarginal,gainmarginal_sspa)"
"0",""
"0","base <- base  %>% "
"0","  mutate("
"0","    revenu=as.character(activite)"
"0","  )"
"0",""
"0","base$cas <- factor(base$cas, levels = c(""Isolé sans enfant"", ""Couple monoactif deux enfants"", ""Couple biactif sans enfant"", ""Couple biactif deux enfants""))"
"0",""
"0",""
"0",""
"0",""
"0","base_long<-base %>% select(gainmarginal_sspa,gainmarginal,cas,revenu) %>% "
"0","  pivot_longer(cols = c(gainmarginal_sspa,gainmarginal), names_to = ""variable"", values_to = ""valeur"")"
"0",""
"0","base_long$variable <- factor(base_long$variable, levels=c(""gainmarginal_sspa"",""gainmarginal""),labels = c(""Sans prime d'activité"", ""Avec prime d'activité""))"
"0",""
"0","graphG2a<-ggplot() +"
"0","  geom_col(data = base_long, aes(x = revenu, y = valeur, fill = variable), "
"0","           position = position_dodge(width = 0.6),  "
"0","           width = 0.4) + "
"0","  facet_wrap(~ cas) +"
"0","  theme_minimal() +"
"0","  scale_fill_manual(values = c(""Sans prime d'activité"" = ""gray"", ""Avec prime d'activité"" = ""gray20"")) +"
"0","  scale_y_continuous(limits = c(-10, 100)) +"
"0","  scale_x_discrete(expand = expansion(add = c(0.5, 0.5))) + "
"0"," labs(x = ""Revenu individuel en parts de smic"","
"0","      y = ""Taux de gain marginal"") + "
"0","  theme("
"0","    legend.position = ""bottom"","
"0","    legend.title = element_blank(),"
"0","    axis.title.x = element_text(size = 10),  "
"0","    axis.title.y = element_text(size = 10),"
"0","    panel.border = element_rect(color = ""black"", fill = NA, linewidth = 0.5)"
"0","    #plot.title = element_text(size = 10, color = ""#FDAE61"", face = ""bold"")"
"0","    "
"0","    )"
"0",""
"0",""
"0",""
"0",""
"0","graphG2b<-ggplot() +"
"0","  geom_col(data = base_long, aes(x = revenu, y = valeur, fill = cas), "
"0","           position = position_dodge(width = 0.6),  "
"0","           width = 0.4) + "
"0","  facet_wrap(~ variable) +"
"0","  theme_minimal() +"
"0","  scale_fill_brewer(palette = ""Spectral"") +"
"0","  scale_y_continuous(limits = c(-10, 100)) +"
"0","  scale_x_discrete(expand = expansion(add = c(0.5, 0.5))) + "
"0"," labs(x = ""Revenu individuel en parts de smic"","
"0","      y = ""Taux de gain marginal"") + "
"0","  theme("
"0","    legend.position = ""bottom"","
"0","    legend.title = element_blank(),"
"0","    axis.title.x = element_text(size = 10),  "
"0","    axis.title.y = element_text(size = 10),"
"0","    panel.border = element_rect(color = ""black"", fill = NA, linewidth = 0.5)"
"0","    #plot.title = element_text(size = 10, color = ""#FDAE61"", face = ""bold"")"
"0","    )"
"0",""
"0","#graphG2i <- ggplotly(graphG2, tooltip = ""text"")"
"0","#graphG2i <- graphG2i %>%"
"0","#  plotly::layout("
"0","#     legend = list("
"0","#      orientation = 'h',  "
"0","#      x = 0.5,  "
"0","#      xanchor = 'center',  "
"0","#      y = -0.3,"
"0","#      title = list(text = """"),"
"0","#      itemwidth=60,"
"0","#      traceorder='normal'"
"0","#    )"
"0","#  )"
"0",""
"0",""
"0","#if (is_html_output()) {"
"0","#  graphG2i"
"0","#} else {"
"0","  print(graphG2a)"
