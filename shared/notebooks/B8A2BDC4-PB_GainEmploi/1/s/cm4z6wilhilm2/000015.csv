"0","#| label: fig-gainsmarginaux"
"0","#| fig-cap: Gain marginaux effectifs pour une augmentation de 100 euros du revenu d'activité, selon la configuration familiale et le niveau de revenu initial "
"0",""
"0","castyp <- read_excel(""cas types gains marginaux.xlsx"",sheet = ""synthese"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    cas = case_when(isocou==""isolé"" & nbenf==0 ~ ""Isolé sans enfant"","
"0","                    isocou==""isolé"" & nbenf==1 ~ ""Isolé 1 enfant"","
"0","                    isocou==""isolé"" & nbenf==2 ~ ""Isolé 2 enfants"","
"0","                    isocou==""couple"" & actconj==""Inactif"" & nbenf==0 ~ ""Couple monoactif sans enfant"","
"0","                    isocou==""couple"" & actconj==""Inactif"" & nbenf==1 ~ ""Couple monoactif 1 enfant"","
"0","                    isocou==""couple"" & actconj==""Inactif"" & nbenf==2 ~ ""Couple monoactif deux enfants"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==0 ~ ""Couple biactif sans enfant"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==1 ~ ""Couple biactif 1 enfant"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==2 ~ ""Couple biactif deux enfants"", "
"0","                    TRUE ~ ""autre"""
"0","  )) %>% "
"0","  filter(cas != ""autre"")  %>% "
"0","  mutate("
"0","    gainmarginal = round(RDISP,1),"
"0","    gainmarginal_sspa = round(RDISP-PA,1)"
"0","    "
"0","  ) %>% "
"0","  select(cas, activite, gainmarginal,gainmarginal_sspa)"
"0",""
"0","base <- base  %>% "
"0","  mutate("
"0","    revenu=as.character(activite)"
"0","  )"
"0",""
"0","base$cas <- factor(base$cas, "
"0","                   levels = c(""Isolé sans enfant"",""Isolé 1 enfant"",""Isolé 2 enfants"", "
"0","                              ""Couple monoactif sans enfant"",""Couple monoactif 1 enfant"",""Couple monoactif deux enfants"", "
"0","                              ""Couple biactif sans enfant"",""Couple biactif 1 enfant"", ""Couple biactif deux enfants""))"
"0",""
"0",""
"0",""
"0","base_long<-base %>% select(gainmarginal_sspa,gainmarginal,cas,revenu) %>% "
"0","  pivot_longer(cols = c(gainmarginal_sspa,gainmarginal), names_to = ""variable"", values_to = ""valeur"")"
"0",""
"0","base_long$variable <- factor(base_long$variable, levels=c(""gainmarginal_sspa"",""gainmarginal""),labels = c(""Sans prime d'activité"", ""Avec prime d'activité""))"
"0",""
"0","graphG2<-ggplot() +"
"0","  geom_col_interactive(data = base_long, "
"0","                       aes(x = revenu, y = valeur, fill = variable,"
"0","           tooltip=paste(""Gain marginal pour 100 € de salaire en plus:"",valeur, ""euros"")), "
"0","           position = position_dodge(width = 0.6),  "
"0","           width = 0.4) + "
"0","  facet_wrap(~ cas) +"
"0","  theme_minimal() +"
"0","  scale_fill_manual(values = c(""Sans prime d'activité"" = ""#482677FF"", ""Avec prime d'activité"" = ""#95D840FF"")) +"
"0","  scale_y_continuous(limits = c(-50, 100),breaks = seq(-50, 100, by = 25)) +"
"0","  scale_x_discrete(expand = expansion(add = c(0.5, 0.5))) + "
"0"," labs("
"0","   # title=""Avec ou sans prime d'activité"","
"0"," x = ""Revenu individuel en parts de smic"","
"0","      y = ""Taux de gain marginal"") + "
"0","  theme("
"0","    legend.position = ""bottom"","
"0","    legend.title = element_blank(),"
"0","    plot.margin = margin(t = 2, r = 5, b = 2, l = 5),"
"0","    axis.title.x = element_text(size = rel(0.8)),  "
"0","    axis.title.y = element_text(size = rel(0.8)),"
"0","    panel.border = element_rect(color = ""black"", fill = NA, linewidth = 0.3),"
"0","    legend.key.size = unit(0.5, ""lines""),  # taille des carrés"
"0","    plot.title = element_text(size = 10, color = ""#5E4FA2"", face = ""bold"")"
"0","    )"
"0",""
"0",""
"0",""
"0","igraphG2<-girafe(ggobj = graphG2)"
"0",""
"0","if (is_html_output()) {"
"0","  igraphG2"
"0","} else {"
"0","  print(graphG2)"
"0","}"
