"0","#| label: fig-TGE"
"0","#| fig-cap: Taux  effectif de gain à l'emploi pour une reprise d'emploi au Smic à mi-temps ou à temps-plein, selon la configuration familiale"
"0",""
"0","castyp <- read_excel(""cas types smic.xlsx"",sheet = ""synthese"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    casconj=case_when(isocou==""isolé"" ~ ""Sans conjoint"","
"0","                  isocou==""couple"" & actconj==""Inactif"" ~ ""Conjoint \nsans revenu"","
"0","                  isocou==""couple"" & actconj==""Chômeur"" ~ ""Conjoint \nchômeur"","
"0","                  isocou==""couple"" & actconj==""1 smic"" ~ ""Conjoint \nsalarié au smic"","
"0","                  TRUE ~ ""Conjoint \nsalarié à 1,5 smic""),"
"0","    enf=case_when(nbenf==0 ~ ""0 enfant"","
"0","                  nbenf==1 ~ ""1 enfant"","
"0","                  nbenf==2 ~ ""2 enfants"","
"0","                  TRUE ~ ""3 enfants""),"
"0","    act=case_when(activite<1 ~ 100*activite,"
"0","                  Salaire==smic ~ 100,"
"0","                  TRUE ~ 150),"
"0","    emp=case_when("
"0","    Salaire==0 ~ ""Sans emploi"","
"0","    Salaire==699.35 ~ ""Emploi à mi-temps au Smic"","
"0","    Salaire==1398.70 ~ ""Emploi à temps plein au Smic"","
"0","    TRUE~""autre"""
"0","  ),"
"0","    RDISP_SSPA=RDISP-PA"
"0","    ) %>% "
"0","  select(casconj,enf,Salaire,act,RDISP,RDISP_SSPA) "
"0",""
"0","basegr1<-base %>% "
"0","  pivot_wider(names_from=act, values_from = c(Salaire, RDISP,RDISP_SSPA)) %>% "
"0","  mutate("
"0","    TGM=round(100*((RDISP_50-RDISP_0)/(Salaire_50-Salaire_0)),1),"
"0","    TGMspa=round(100*((RDISP_SSPA_50-RDISP_SSPA_0)/(Salaire_50-Salaire_0)),1),"
"0","    emploi=""Emploi à mi-temps"""
"0"," ) %>% "
"0","  select(casconj,enf,emploi,TGM,TGMspa)"
"0",""
"0","basegr2<-base %>% "
"0","  pivot_wider(names_from=act, values_from = c(Salaire, RDISP,RDISP_SSPA)) %>% "
"0","  mutate("
"0","    TGM=round(100*((RDISP_100-RDISP_0)/(Salaire_100-Salaire_0)),1),"
"0","    TGMspa=round(100*((RDISP_SSPA_100-RDISP_SSPA_0)/(Salaire_100-Salaire_0)),1),"
"0","    emploi=""Emploi à temps plein"""
"0"," ) %>% "
"0","  select(casconj,enf,emploi,TGM,TGMspa)"
"0",""
"0","basegr<-rbind(basegr1, basegr2)"
"0",""
"0","basegr$enf <- factor(basegr$enf, levels=c(""0 enfant"",""1 enfant"",""2 enfants"",""3 enfants""))"
"0",""
"0","basegr$casconj <- factor(basegr$casconj,levels=c(""Sans conjoint"",""Conjoint \nsans revenu"","
"0","                                               ""Conjoint \nchômeur"",""Conjoint \nsalarié au smic"","
"0","                                               ""Conjoint \nsalarié à 1,5 smic""))"
"0",""
"0","basegr$emploi <- factor(basegr$emploi, levels=c(""Emploi à mi-temps"",""Emploi à temps plein""))"
"0",""
"0",""
"0","base_long <- basegr %>%"
"0","  select(enf, emploi, casconj, TGM,TGMspa) %>%"
"0","  pivot_longer(cols = c(TGM,TGMspa),"
"0","               names_to = ""prime_activite"","
"0","               values_to = ""TGM"") %>%"
"0","  mutate(prime_activite = ifelse(prime_activite == ""TGM"", ""Avec \nprime d'activité"", ""Sans \nprime d'acivité""))"
"0",""
"0",""
"0","graph4 <- ggplot() +"
"0","  geom_point_interactive("
"0","    data = base_long, aes(x =casconj, y = TGM, "
"0","      colour = enf, "
"0","      tooltip=paste(""Taux effectif de gain à l'emploi :"",TGM, ""%"")), "
"0","    size = 3"
"0","  )+"
"0","  facet_wrap(~emploi,nrow=1)+"
"0","  labs(title = ""Avec ou sans prime d'activité"") +"
"0","  theme_minimal() +"
"0","  scale_y_continuous(limits = c(-10, 100)) + "
"0","  theme("
"0","    panel.border = element_rect(color = ""black"", fill = NA, linewidth = 0.5),"
"0","    panel.spacing = unit(0.5, ""lines""),"
"0","    strip.background = element_blank(),"
"0","    axis.title.x = element_blank(),"
"0","    axis.title.y = element_blank(),"
"0","    legend.title = element_blank(),"
"0","    legend.position = ""right"","
"0","    plot.margin = margin(t = 20, r = 10, b = 20, l = 10),"
"0","    axis.line = element_line(color = ""black"", linewidth = 0.2, linetype = ""solid""),"
"0","    axis.text.x = element_text(size = rel(0.9), angle = 40, hjust = 1, vjust = 1),"
"0","    strip.text= element_text(size = rel(0.8),face=""bold""),"
"0","    plot.title = element_text(size = 10, color=""#5E4FA2"",face=""bold"")"
"0","  )+"
"0","  facet_grid(prime_activite ~ emploi)"
"0",""
"0",""
"0","igraph4<-ggplotly(graph4, tooltip=""text"")"
"0","igraph4<-igraph4 %>%"
"0","  plotly::layout("
"0","     legend = list("
"0","      orientation = 'v',  "
"0","      x = 1,  "
"0","      xanchor = 'left',  "
"0","      y = 0.5,"
"0","      title = list(text = """"),"
"0","      itemwidth=60,"
"0","      traceorder='normal'"
"0","    )"
"0","  )"
"0",""
"0","if (is_html_output()) {"
"0","  igraph4"
"0","} else {"
"0","  print(graph4)"
"0","}"
