"0","#| label: fig-nivvie"
"0","#| fig-cap: Niveau de vie et risque de pauvret√© mon√©taire selon le salaire et la configuration familiale"
"0","#| fig-asp: 1"
"0",""
"0",""
"0","#  fig-width: 12"
"0","#  fig-height: 8"
"0","#  fig-align: center"
"0",""
"0",""
"0",""
"0","seuilpm=1312"
"0",""
"0","castyp <- readxl::read_xlsx(""data/Sofi2024_cas_types_smic.xlsx"", sheet = ""TGE"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    cas = case_when(isocou==""isol√©"" ~ ""Isol√©"","
"0","                    isocou==""couple"" & actconj==""Inactif"" ~ ""En couple\nconjoint sans revenu"","
"0","                    isocou==""couple"" & actconj==""1 smic"" ~ ""En couple\nconjoint au Smic"","
"0","                    isocou==""couple"" & actconj==""Ch√¥meur"" ~ ""En couple\nconjoint au ch√¥mage"", "
"0","                    TRUE ~ ""autre"""
"0","  ),"
"0","   nbenf2 = case_when(nbenf==0 ~ ""Sans enfant"","
"0","                    nbenf==1 ~ ""1 enfant"","
"0","                    nbenf==2 ~ ""2 enfants"","
"0","                    TRUE ~ ""autre"""
"0","  ),"
"0","  emp=case_when("
"0","    Salaire==0 ~ ""Sans emploi"","
"0","    Salaire==699.35 ~ ""Emploi √† mi-temps au Smic"","
"0","    Salaire==1398.70 ~ ""Emploi √† temps plein au Smic"","
"0","    TRUE~""autre"""
"0","  ),"
"0","  NVIESSPA=(RDISP-PA)/(RDISP/NVIE)"
"0","  ) %>% "
"0","  filter(cas != ""autre"" & nbenf2!=""autre"" & emp !=""autre"") %>% "
"0","  select(cas, nbenf2, NVIE,NVIESSPA,emp)"
"0",""
"0","base$emp <- factor(base$emp, levels = c(""Sans emploi"", ""Emploi √† mi-temps au Smic"", ""Emploi √† temps plein au Smic""))"
"0",""
"0","base$cas <- factor(base$cas, levels = c(""Isol√©"", ""En couple\nconjoint sans revenu"", ""En couple\nconjoint au Smic"",""En couple\nconjoint au ch√¥mage""))"
"0",""
"0","base$nbenf2 <- factor(base$nbenf2, levels = c(""Sans enfant"", ""1 enfant"", ""2 enfants"")) "
"0",""
"0","seuils <- data.frame("
"0","  seuil = c(seuilpm, seuilpm*4/6),"
"0","  type = c(""Seuil de pauvret√© mon√©taire (60 %)"", ""Seuil de grande pauvret√© mon√©taire (40 %)"")"
"0",")"
"0",""
"0","base_long <- base %>%"
"0","  select(nbenf2, emp, cas, NVIE, NVIESSPA) %>%"
"0","  pivot_longer(cols = c(NVIE, NVIESSPA),"
"0","               names_to = ""prime_activite"","
"0","               values_to = ""montant"") %>%"
"0","  mutate(prime_activite = ifelse(prime_activite == ""NVIE"", ""Avec \nprime d'activit√©"", ""Sans \nprime d'acivit√©""))"
"0",""
"0","graph_pm<-ggplot() +"
"0","    geom_point_interactive("
"0","    data = base_long, aes(x =nbenf, y = round(montant,0), "
"0","      colour = emp, "
"0","      tooltip=paste(""Niveau de vie :"",round(montant,0), ""‚Ç¨"")), "
"0","    size = 3"
"0","  )+"
"0","  facet_wrap(~cas, nrow = 1) +"
"0","  geom_hline(data = seuils, aes(yintercept = seuil, linetype = type),"
"0","             color = ""grey40"", linewidth = 0.5) +"
"0","  scale_y_continuous(limits = c(0, 2500)) +"
"0","  scale_linetype_manual("
"0","    name = """", "
"0","    values = c(""Seuil de pauvret√© mon√©taire (60 %)"" = ""solid"", "
"0","               ""Seuil de grande pauvret√© mon√©taire (40 %)"" = ""dashed"")"
"0","  ) +"
"0","  labs(color = ""Statut emploi"","
"0","       linetype = ""Seuils"") +"
"0","  facet_grid(prime_activite ~ cas)+"
"0","  theme("
"0","    legend.position = ""below"","
"0","    legend.title = element_blank()"
"0","    ) +"
"0","  xlab(""Nombre d'enfants"")+ylab(NULL)+"
"0","  ofce_caption(source =""l√©gislation avril 2024, maquette Sofi https://github.com/murielpucci/SOFI"")"
"0",""
"0",""
"0",""
"0","girafy(graph_pm)"
"1","[1m[33mError[39m:[22m
[38;5;232m[33m![38;5;232m Problem while computing aesthetics.
[36m‚Ñπ[38;5;232m Error occurred in the 1st layer.[39m
[1mCaused by error:[22m
[33m![39m objet 'nbenf' introuvable
[90mRun `]8;;x-r-run:rlang::last_trace()rlang::last_trace()]8;;` to see where the error occurred.[39m
"
