"0","#| label: fig-nivvie"
"0","#| fig-cap: Niveau de vie et risque de pauvreté monétaire selon le salaire et la configuration familiale"
"0","#| fig-asp: 0.7"
"0",""
"0",""
"0","seuilpm=1312"
"0",""
"0","castyp <- readxl::read_xlsx(""data/Sofi2024_cas_types_smic.xlsx"", sheet = ""TGE"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    cas = case_when(isocou==""isolé"" ~ ""Isolé"","
"0","                    isocou==""couple"" & actconj==""Inactif"" ~ ""conjoint sans revenu"","
"0","                    isocou==""couple"" & actconj==""1 smic"" ~ ""conjoint au Smic"","
"0","                    isocou==""couple"" & actconj==""Chômeur"" ~ ""conjoint au chômage"", "
"0","                    TRUE ~ ""autre""),"
"0","  emp=case_when("
"0","    Salaire==0 ~ ""Sans emploi"","
"0","    Salaire==699.35 ~ ""Emploi à mi-temps au Smic"","
"0","    Salaire==1398.70 ~ ""Emploi à temps plein au Smic"","
"0","    TRUE~""autre""),"
"0","  NVIESSPA=(RDISP-PA)/(RDISP/NVIE)"
"0","  ) %>% "
"0","  filter(cas != ""autre"" & nbenf<3 & emp !=""autre"") %>% "
"0","  select(cas, nbenf, NVIE,NVIESSPA,emp)"
"0",""
"0","base$emp <- factor(base$emp, levels = c(""Sans emploi"", ""Emploi à mi-temps au Smic"", ""Emploi à temps plein au Smic""))"
"0",""
"0","base$cas <- factor(base$cas, levels = c(""Isolé"", ""conjoint sans revenu"", ""conjoint au Smic"",""conjoint au chômage""))"
"0",""
"0","base$nbenf <- factor(base$nbenf, levels = c(""0"", ""1"", ""2"")) "
"0",""
"0","seuils <- data.frame("
"0","  seuil = c(seuilpm, seuilpm*4/6),"
"0","  type = c(""Seuil de pauvreté monétaire (60 %)"", ""Seuil de grande pauvreté monétaire (40 %)"")"
"0",")"
"0",""
"0","base_long <- base %>%"
"0","  select(nbenf, emp, cas, NVIE, NVIESSPA) %>%"
"0","  pivot_longer(cols = c(NVIE, NVIESSPA),"
"0","               names_to = ""prime_activite"","
"0","               values_to = ""montant"") %>%"
"0","  mutate(prime_activite = ifelse(prime_activite == ""NVIE"", ""Avec \nprime d'activité"", ""Sans \nprime d'acivité""))"
"0",""
"0","graph_pm<-ggplot() +"
"0","    geom_point_interactive("
"0","    data = base_long, aes(x =nbenf, y = round(montant,0), "
"0","      colour = emp, "
"0","      tooltip=paste(""Niveau de vie :"",round(montant,0), ""€"")), "
"0","    size = 1.5"
"0","  )+"
"0","  facet_wrap(~cas, nrow = 1) +"
"0","  geom_hline(data = seuils, aes(yintercept = seuil, linetype = type),"
"0","             color = ""grey40"", linewidth = 0.5) +"
"0","  scale_y_continuous(limits = c(0, 2500)) +"
"0","  scale_linetype_manual("
"0","    name = """", "
"0","    values = c(""Seuil de pauvreté monétaire (60 %)"" = ""solid"", "
"0","               ""Seuil de grande pauvreté monétaire (40 %)"" = ""dashed"")"
"0","  ) +"
"0","  labs(color = ""Statut d'emploi"","
"0","       linetype = ""Seuils"") +"
"0","  facet_grid(prime_activite ~ cas)+"
"0","  guides(x = guide_axis(n.dodge=1), color = guide_legend(title = NULL)) +"
"0","  theme("
"0","    legend.position = ""bottom"","
"0","    plot.caption = element_marquee(margin = margin(t=9)),"
"0","    panel.border = element_rect(colour = ""grey"", fill=""transparent"", linetype=""solid"", linewidth = 0.2),"
"0","    ) +"
"0","  xlab(""Nombre d'enfants"")+ylab(NULL)+"
"0","  ofce_caption(source =""législation avril 2024, maquette Sofi https://github.com/murielpucci/SOFI"")"
"0",""
"0",""
"0","girafy(graph_pm)"
