"0","#| label: fig-TGE"
"0","#| fig-cap: Taux  effectif de gain à l'emploi pour une reprise d'emploi au Smic à mi-temps ou à temps-plein, selon la configuration familiale"
"0","#| fig-asp: 1"
"0",""
"0","castyp <- readxl::read_xlsx(""data/Sofi2024_cas_types_smic.xlsx"", sheet = ""TGE"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    casconj=case_when(isocou==""isolé"" ~ ""Sans conjoint"","
"0","                  isocou==""couple"" & actconj==""Inactif"" ~ ""Conjoint \nsans revenu"","
"0","                  isocou==""couple"" & actconj==""Chômeur"" ~ ""Conjoint \nchômeur"","
"0","                  isocou==""couple"" & actconj==""1 smic"" ~ ""Conjoint \nsalarié au smic"","
"0","                  TRUE ~ ""Conjoint \nsalarié à 1,5 smic""),"
"0","    enf=case_when(nbenf==0 ~ ""0 enfant"","
"0","                  nbenf==1 ~ ""1 enfant"","
"0","                  nbenf==2 ~ ""2 enfants"","
"0","                  TRUE ~ ""3 enfants""),"
"0","    act=case_when(activite<1 ~ 100*activite,"
"0","                  Salaire==smic ~ 100,"
"0","                  TRUE ~ 150),"
"0","    emp=case_when("
"0","    Salaire==0 ~ ""Sans emploi"","
"0","    Salaire==699.35 ~ ""Emploi à mi-temps au Smic"","
"0","    Salaire==1398.70 ~ ""Emploi à temps plein au Smic"","
"0","    TRUE~""autre"""
"0","  ),"
"0","    RDISP_SSPA=RDISP-PA"
"0","    ) %>% "
"0","  select(casconj,enf,Salaire,act,RDISP,RDISP_SSPA) "
"0",""
"0","basegr1<-base %>% "
"0","  pivot_wider(names_from=act, values_from = c(Salaire, RDISP,RDISP_SSPA)) %>% "
"0","  mutate("
"0","    TGM=round(100*((RDISP_50-RDISP_0)/(Salaire_50-Salaire_0)),1),"
"0","    TGMspa=round(100*((RDISP_SSPA_50-RDISP_SSPA_0)/(Salaire_50-Salaire_0)),1),"
"0","    emploi=""Emploi à mi-temps"""
"0"," ) %>% "
"0","  select(casconj,enf,emploi,TGM,TGMspa)"
"0",""
"0","basegr2<-base %>% "
"0","  pivot_wider(names_from=act, values_from = c(Salaire, RDISP,RDISP_SSPA)) %>% "
"0","  mutate("
"0","    TGM=round(100*((RDISP_100-RDISP_0)/(Salaire_100-Salaire_0)),1),"
"0","    TGMspa=round(100*((RDISP_SSPA_100-RDISP_SSPA_0)/(Salaire_100-Salaire_0)),1),"
"0","    emploi=""Emploi à temps plein"""
"0"," ) %>% "
"0","  select(casconj,enf,emploi,TGM,TGMspa)"
"0",""
"0","basegr<-rbind(basegr1, basegr2)"
"0",""
"0","basegr$enf <- factor(basegr$enf, levels=c(""0 enfant"",""1 enfant"",""2 enfants"",""3 enfants""))"
"0",""
"0","basegr$casconj <- factor(basegr$casconj,levels=c(""Sans conjoint"",""Conjoint \nsans revenu"","
"0","                                               ""Conjoint \nchômeur"",""Conjoint \nsalarié au smic"","
"0","                                               ""Conjoint \nsalarié à 1,5 smic""))"
"0",""
"0","basegr$emploi <- factor(basegr$emploi, levels=c(""Emploi à mi-temps"",""Emploi à temps plein""))"
"0",""
"0",""
"0","base_long <- basegr %>%"
"0","  select(enf, emploi, casconj, TGM,TGMspa) %>%"
"0","  pivot_longer(cols = c(TGM,TGMspa),"
"0","               names_to = ""prime_activite"","
"0","               values_to = ""TGM"") %>%"
"0","  mutate(prime_activite = ifelse(prime_activite == ""TGM"", ""Avec \nprime d'activité"", ""Sans \nprime d'acivité""))"
"0",""
"0",""
"0","graph4 <- ggplot() +"
"0","  geom_point_interactive("
"0","    data = base_long, aes(x =casconj, y = TGM, "
"0","      colour = enf, "
"0","      tooltip=paste(""Taux effectif de gain à l'emploi :"",TGM, ""%"")), "
"0","    size = 2"
"0","  )+"
"0","  facet_wrap(~emploi,nrow=1)+"
"0","  scale_y_continuous(limits = c(-10, 100)) + "
"0","  xlab(NULL)+ylab(NULL) +"
"0","  theme("
"0","    legend.position = ""right"", "
"0","    plot.caption = element_marquee(margin = margin(t=9)),"
"0","    panel.border = element_rect(colour = ""grey"", fill=""transparent"", linetype=""solid"", linewidth = 0.2),"
"0","    panel.spacing = unit(12, ""pt""))+"
"0","  facet_grid(prime_activite ~ emploi)+"
"0","  guides(x = guide_axis(n.dodge=2), color = guide_legend(title = NULL)) +"
"0","  ofce_caption(source =""législation avril 2024, maquette Sofi https://github.com/murielpucci/SOFI"")"
"0",""
"0","girafy(graph4)"
