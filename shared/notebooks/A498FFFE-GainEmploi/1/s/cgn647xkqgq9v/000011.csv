"0","#| label: fig-C1A0E"
"0","#| fig-cap: Revenu disponible d'une personne seule selon son revenu professionnel"
"0","#| fig-width: 8"
"0","#| fig-height: 5"
"0",""
"0",""
"0","castyp <- readxl::read_xlsx(""data/Sofi2024_cas_types_smic.xlsx"", sheet = ""TGE"")"
"0","seuilpm=1312 # seuil de pauvreté à 60% actualisé en 2023. voir note dans le texte."
"0","smic=1398.7 # SMIC mensuel net en 2023"
"0",""
"0","base<-castyp %>% "
"0","  filter(isocou==""isolé"" & nbenf==0) %>% "
"0","  mutate(typrev=case_when("
"0","    activite==0 ~ ""Sans revenu"","
"0","    activite==0.5 ~ ""Avec un mi-temps \n au Smic"","
"0","    activite==1 & Salaire==smic ~ ""Avec un temps plein\n au Smic"","
"0","    TRUE ~ ""Avec un temps plein \n à 1,5 Smic"")"
"0","  ) %>% "
"0","  mutate("
"0","    seuil60 = seuilpm"
"0","  ) %>% "
"0","  select(typrev,Salaire,PF,PL,RSA,PA, RDISP, seuil60)	"
"0",""
"0","basegr<-base %>% "
"0","  pivot_longer(cols=c(Salaire,PF,PL,RSA,PA, RDISP)) "
"0",""
"0","basegr$typrev<-factor(basegr$typrev,levels=c(""Sans revenu"",""Avec un mi-temps \n au Smic"",""Avec un temps plein\n au Smic"",""Avec un temps plein \n à 1,5 Smic""))"
"0",""
"0","basegr$name<-factor(basegr$name, levels=rev(c(""Salaire"", ""PF"", ""PL"", ""RSA"", ""PA"", ""RDISP"")))"
"0",""
"0","labels_rev <- c(""Salaire"" = ""Salaire"", ""PF"" = ""Prestations familiales"", ""PL"" = ""Prestations logement"", "
"0","               ""RSA"" = ""RSA"", ""PA"" = ""Prime d'activité"")"
"0",""
"0","graph <- ggplot(basegr %>% filter(name !='RDISP'), aes(fill = name,"
"0","  y = value, x = typrev)) + "
"0","  scale_fill_manual("
"0","    values = c(""Salaire"" = ""#482677FF"", ""PF"" = ""#39568CFF"", ""PL"" = ""#238A8DFF"", "
"0","               ""RSA"" = ""#55C667FF"", ""PA"" = ""#95D840FF""),"
"0","    labels = labels_rev,"
"0","    guide = guide_legend(reverse = TRUE)  "
"0","  ) +"
"0","   geom_bar_interactive("
"0","    position = ""stack"", "
"0","    stat = ""identity"", "
"0","    width = 0.5,"
"0","    aes(y=value, fill=name,tooltip=paste(name, "":"", round(value,0),""euros""))"
"0","  ) +"
"0","    geom_point_interactive("
"0","    data = basegr %>% filter(name == 'RDISP'), "
"0","    aes("
"0","      x = typrev, y = round(value, 2), "
"0","      colour = ""Revenu disponible"", "
"0","      tooltip=paste(""Revenu disponible"",round(value,0), ""euros"")), "
"0","    size = 3"
"0","  ) +"
"0","    guides("
"0","    colour=guide_legend(title = NULL, order = 1) ,"
"0","    fill = guide_legend(title = NULL, order = 2) "
"0","  ) +"
"0","  theme(legend.position.inside =  c(0.05, 0.95),"
"0","        legend.justification = c(0,1),    "
"0","        plot.caption = element_marquee(margin = margin(t=9))"
"0","        ) +"
"0","  xlab(NULL) + ylab(NULL) +"
"0","  scale_y_continuous(expand = c(0, 0), limits = c(0, 2500), breaks = seq(0, 2500, by = 500)) + "
"0","  ofce_caption("
"0","    source = ""législation avril 2024, maquette Sofi https://github.com/murielpucci/SOFI"""
"0","    )"
"0",""
"0","girafy(graph)"
