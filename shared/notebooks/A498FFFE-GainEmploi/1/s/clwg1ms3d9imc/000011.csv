"0","#| label: fig-gainsmarginaux"
"0","#| fig-cap: Gain marginaux effectifs pour une augmentation de 100 euros du revenu d'activité, selon la configuration familiale et le niveau de revenu initial "
"0","#| fig-asp: 1"
"0","#| fig-pos: ""H"""
"0",""
"0","castyp <- readxl::read_xlsx(""data/Sofi2024_cas_types_smic.xlsx"", sheet = ""TGME"")"
"0",""
"0","base<-castyp %>% "
"0","  mutate("
"0","    cas = case_when(isocou==""isolé"" & nbenf==0 ~ ""Isolé sans enfant"","
"0","                    isocou==""isolé"" & nbenf==1 ~ ""Isolé 1 enfant"","
"0","                    isocou==""isolé"" & nbenf==2 ~ ""Isolé 2 enfants"","
"0","                    isocou==""couple"" & actconj==""Inactif"" & nbenf==0 ~ ""Couple monoactif sans enfant"","
"0","                    isocou==""couple"" & actconj==""Inactif"" & nbenf==1 ~ ""Couple monoactif 1 enfant"","
"0","                    isocou==""couple"" & actconj==""Inactif"" & nbenf==2 ~ ""Couple monoactif deux enfants"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==0 ~ ""Couple biactif sans enfant"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==1 ~ ""Couple biactif 1 enfant"","
"0","                    isocou==""couple"" & actconj==""1 smic"" & nbenf==2 ~ ""Couple biactif deux enfants"", "
"0","                    TRUE ~ ""autre"""
"0","  )) %>% "
"0","  filter(cas != ""autre"")  %>% "
"0","  mutate("
"0","    gainmarginal = round(RDISP,1),"
"0","    gainmarginal_sspa = round(RDISP-PA,1)"
"0","    "
"0","  ) %>% "
"0","  select(cas, activite, gainmarginal,gainmarginal_sspa)"
"0",""
"0","base <- base  %>% "
"0","  mutate("
"0","    revenu=as.character(activite)"
"0","  )"
"0",""
"0","base$cas <- factor(base$cas, "
"0","                   levels = c(""Isolé sans enfant"",""Isolé 1 enfant"",""Isolé 2 enfants"", "
"0","                              ""Couple monoactif sans enfant"",""Couple monoactif 1 enfant"",""Couple monoactif deux enfants"", "
"0","                              ""Couple biactif sans enfant"",""Couple biactif 1 enfant"", ""Couple biactif deux enfants""))"
"0",""
"0",""
"0",""
"0","base_long<-base %>% select(gainmarginal_sspa,gainmarginal,cas,revenu) %>% "
"0","  pivot_longer(cols = c(gainmarginal_sspa,gainmarginal), names_to = ""variable"", values_to = ""valeur"")"
"0",""
"0","base_long$variable <- factor(base_long$variable, levels=c(""gainmarginal_sspa"",""gainmarginal""),labels = c(""Sans prime d'activité"", ""Avec prime d'activité""))"
"0",""
"0","graphG2<-ggplot() +"
"0","  geom_col_interactive(data = base_long, "
"0","                       aes(x = revenu, y = valeur, fill = variable,"
"0","           tooltip=paste(""Gain marginal pour 100 € de salaire en plus:"",valeur, ""euros"")), "
"0","           position = position_dodge(width = 0.6),  "
"0","           width = 0.4) + "
"0","  facet_wrap(~ cas) +"
"0","  scale_fill_manual(values = c(""Sans prime d'activité"" = ""#482677FF"", ""Avec prime d'activité"" = ""#95D840FF"")) +"
"0","  scale_y_continuous(limits = c(-50, 100),breaks = seq(-50, 100, by = 25)) +"
"0","  scale_x_discrete(expand = expansion(add = c(0.5, 0.5))) + "
"0","  theme("
"0","    legend.position = ""bottom"","
"0","    plot.caption = element_marquee(margin = margin(t=9)),"
"0","    legend.title = element_blank(),"
"0","    panel.border = element_rect(colour = ""grey"", fill=""transparent"", linetype=""solid"", linewidth = 0.2)"
"0","    ) +"
"0","    xlab(""Revenu individuel en parts de smic"")+ylab(NULL) +"
"0","  ofce_caption(source =""législation avril 2024, maquette Sofi https://github.com/murielpucci/SOFI"")"
"0",""
"0",""
"0","girafy(graphG2)"
